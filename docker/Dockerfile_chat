FROM amazonlinux:latest

WORKDIR /app
USER root
RUN yum update -y
RUN yum -y install wget make gcc openssl-devel bzip2-devel
RUN yum -y install python37
RUN python3 -m pip install --upgrade pip
RUN python3 -m pip install tornado
RUN python3 -m pip install rasa[full]==2.8.10
RUN python3 -m pip install mongoengine==0.23.1
RUN python3 -m pip install smart-config==0.1.3
RUN python3 -m pip install validators
RUN python3 -m pip install dnspython
RUN python3 -m pip install pydantic
RUN python3 -m pip install password-strength
RUN python3 -m pip install cryptography~=3.4.8
RUN python3 -m pip install loguru~=0.5.3
RUN python3 -m pip install elastic-apm
RUN python3 -m pip install passlib[bcrypt]
RUN python3 -m pip install pymongo==3.12.0
RUN python3 -m pip install fastapi
RUN python3 -m spacy download en_core_web_md
RUN python3 -m spacy link en_core_web_md en
RUN python3 -m pip install transformers==4.5.0
RUN python3 -m pip install websockets==9.1


COPY kairon/ /app/kairon
COPY system.yaml /app/
COPY email.yaml /app/

USER 1001
EXPOSE 5000
CMD ["python3","-m", "kairon.chat.server","--logging=debug"]

